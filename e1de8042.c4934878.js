(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{156:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return i})),n.d(t,"default",(function(){return b}));var r=n(1),a=n(6),o=(n(0),n(169)),c={id:"resource_prefetchResources",title:"prefetchResources",sidebar_label:"prefetchResources"},s={id:"resources/resource_prefetchResources",title:"prefetchResources",description:"**prefetchResources** [HOC](https://reactjs.org/docs/higher-order-components.html) that calls async action to retrieve remote data when your component mounts to the [DOM](https://www.w3schools.com/js/js_htmldom.asp).",source:"@site/docs/resources/prefetchResources.md",permalink:"/bones/docs/resources/resource_prefetchResources",editUrl:"https://github.com/alexgul4enko/bones/tree/master/docs/docs/resources/prefetchResources.md",sidebar_label:"prefetchResources",sidebar:"resourcesSitebar",previous:{title:"useResourceData",permalink:"/bones/docs/resources/hooks/use-resource-data"},next:{title:"withFinalForm",permalink:"/bones/docs/resources/resource_withFinalForm"}},i=[{value:"Standard work flow",id:"standard-work-flow",children:[]},{value:"API",id:"api",children:[{value:"resources",id:"resources",children:[]},{value:"options",id:"options",children:[]}]},{value:"Custom Resource",id:"custom-resource",children:[]},{value:"Several resources",id:"several-resources",children:[]}],l={rightToc:i};function b(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"prefetchResources")," ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://reactjs.org/docs/higher-order-components.html"}),"HOC")," that calls async action to retrieve remote data when your component mounts to the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.w3schools.com/js/js_htmldom.asp"}),"DOM"),"."),Object(o.b)("h2",{id:"standard-work-flow"},"Standard work flow"),Object(o.b)("p",null,"The main idea is that in most cases when you need to render some React Element you may need to send HTTP request to retrieve some remote data and then draw your widget. To do this you basically need to implement next logic"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"using React life cycle methods, send HTTP request when your Component will be mounted to the DOM"),Object(o.b)("li",{parentName:"ol"},"Show loading indicator while fetching remote data"),Object(o.b)("li",{parentName:"ol"},"Terminate pending HTTP request when Component will be unmounted from the DOM"),Object(o.b)("li",{parentName:"ol"},"clear Redux store data for given Component.")),Object(o.b)("p",null,"All this things are already implemented with ",Object(o.b)("inlineCode",{parentName:"p"},"prefetchResources"),", so that you can safe your time and do not duplicate your code."),Object(o.b)("h2",{id:"api"},"API"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"prefetchResources(resources, options)\n")),Object(o.b)("h3",{id:"resources"},"resources"),Object(o.b)("p",null,"Resources is ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/resources/connect_resource_type"}),"Resource config"),", or ",Object(o.b)("inlineCode",{parentName:"p"},"Array<ResourceConfig>")),Object(o.b)("h3",{id:"options"},"options"),Object(o.b)("p",null,"Object with additional configurations"),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(r.a)({parentName:"tr"},{align:null}),"Property"),Object(o.b)("th",Object(r.a)({parentName:"tr"},{align:null}),"type"),Object(o.b)("th",Object(r.a)({parentName:"tr"},{align:null}),"Default"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"refresh"),Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"Boolean"),Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"true")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"destroyOnUnmount"),Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"Boolean"),Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"true")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"defaultParams"),Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"Object"),Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"null")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"Loader"),Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"React Element"),Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"({ isLoading, children})=>   isLoading? null :  children"))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"method"),Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),'"POST" or "GET"'),Object(o.b)("td",Object(r.a)({parentName:"tr"},{align:null}),'"GET"')))),Object(o.b)("h4",{id:"refresh"},"refresh"),Object(o.b)("p",null,"Boolean flag that mostly will used in pair with ",Object(o.b)("inlineCode",{parentName:"p"},"destroyOnUnmount = false"),".\nIn general this flag helps to control if it is needed to send HTTP request once more in case there is already redux data under this namespace."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"//Redux store before Component render\n\n{\n  users: {\n    data: {\n      count: 2,\n      results: [\n        { uuid: 1, name: 'Users1'},\n        { uuid: 2, name: 'Users2'},\n      ]\n    }\n  }\n}\n\nimport { prefetchResources } from '@cranium/resource'\n\nprefetchResources('users', { refresh: true })(MyReactElement)\n\n")),Object(o.b)("p",null,"In this example there is already all data in store to render Users List React Component. In case ",Object(o.b)("inlineCode",{parentName:"p"},"refresh")," option is ",Object(o.b)("inlineCode",{parentName:"p"},"false"),", ",Object(o.b)("inlineCode",{parentName:"p"},"prefetchResources")," HOC will NOT send initial GET request. This is mostly performance flag to do not send same HTTP requests."),Object(o.b)("h4",{id:"destroyonunmount"},"destroyOnUnmount"),Object(o.b)("p",null,"Boolean flag to configure if you need to store data after your Component will be removed from the DOM or not."),Object(o.b)("p",null,"For example:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Redux store is empty")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-json"}),'{\n  "cars:": { "data": [] }\n}\n')),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},"React renders Component with ",Object(o.b)("inlineCode",{parentName:"li"},"prefetchResources")," HOC")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),"import { prefetchResources } from '@cranium/resource'\n\nprefetchResources('users')(MyReactElement)\n\n")),Object(o.b)("ol",{start:3},Object(o.b)("li",{parentName:"ol"},"After your element appears in the DOM, ",Object(o.b)("inlineCode",{parentName:"li"},"prefetchResources")," HOC will send GET ",Object(o.b)("inlineCode",{parentName:"li"},"/users")," HTTP request and store data in redux. Now in redux store is")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-json"}),'{\n  "cars:": { "data": [] },\n  "users": {\n    "data": {\n      "count": 2,\n      "results": [\n        { "uuid": 1, "name": "Users1"},\n        { "uuid": 2, "name": "Users2"},\n      ]\n    }\n  }\n}\n')),Object(o.b)("ol",{start:4},Object(o.b)("li",{parentName:"ol"},"Component unmount from the DOM.\nIf ",Object(o.b)("inlineCode",{parentName:"li"},"destroyOnUnmount=true"),", ",Object(o.b)("inlineCode",{parentName:"li"},"prefetchResources")," dispatches ",Object(o.b)("a",Object(r.a)({parentName:"li"},{href:"/docs/resources/connect_resources#clear-resource-data-clear"}),Object(o.b)("inlineCode",{parentName:"a"},"clear")," action"),".\nSo that redux store will be")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-json"}),'{\n  "cars:": { "data": [] }\n}\n')),Object(o.b)("h4",{id:"defaultparams"},"defaultParams"),Object(o.b)("p",null,"Default params is an optional param to pass hard-coded values to initial HTTP request."),Object(o.b)("p",null,"GET ",Object(o.b)("inlineCode",{parentName:"p"},"/api/users?offset=0&limit=25")," on Component mount"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js",metastring:"{5,7-10}","{5,7-10}":!0}),"import { prefetchResources } from '@cranium/resource'\n\nprefetchResources({\n  namespace: 'users',\n  queries: ['offset', 'limit']\n}, {\n  defaultParams: {\n    offset: 0,\n    limit: 25\n  }\n})(MyReactElement)\n")),Object(o.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(r.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(r.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(o.b)("path",Object(r.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Please do not forget that you need to define ",Object(o.b)("inlineCode",{parentName:"p"},"queries")," in Resource configs)"))),Object(o.b)("h4",{id:"loader"},"Loader"),Object(o.b)("p",null,"React Element that will be shown while initial request is pending."),Object(o.b)("div",{className:"admonition admonition-important alert alert--info"},Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(r.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(r.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(r.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"important")),Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"This component will be shown ",Object(o.b)("strong",{parentName:"p"},"only")," when ",Object(o.b)("strong",{parentName:"p"},"initial")," request is pending. "))),Object(o.b)("p",null,"By default ",Object(o.b)("inlineCode",{parentName:"p"},"prefetchResources")," will not render your Component while initial request is pending.\nIf you want to show your own loader you can create your Loader Component for example."),Object(o.b)("p",null,"Loader component accepts 2 props ",Object(o.b)("inlineCode",{parentName:"p"},"isLoading")," and ",Object(o.b)("inlineCode",{parentName:"p"},"children"),"."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx",metastring:'title="loader.js"',title:'"loader.js"'}),'function MyAwesomeLoader({ isLoading, children }){\n  if(isLoading){\n    return "Let\'s enjoy this awesome text while fetching data"\n  }\n  return children\n}\n')),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import { prefetchResources } from '@cranium/resource'\nimport { MyAwesomeLoader } from './loader.js'\n\nprefetchResources({\n  namespace: 'users',\n  queries: ['offset', 'limit']\n}, {\n  Loader: MyAwesomeLoader\n})(MyReactElement)\n")),Object(o.b)("h2",{id:"custom-resource"},"Custom Resource"),Object(o.b)("p",null,"You can use ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/resources/resource_customresources"}),"customResource")," with ",Object(o.b)("inlineCode",{parentName:"p"},"prefetchResources")," to call your custom async function on Component mount "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import { customResource, prefetchResources } from '@cranium/resource'\n\nfunction myCustomFetch(API, payload, meta) {\n  return API.get('/context')\n}\n\nconst customConnectResource = customResource(myCustomFetch)\n\nexport default prefetchResources(\n  customConnectResource({ namespace: 'test' }),\n  {\n    Loader: Loader,\n  }\n)\n\n//or same with short syntax\nexport default prefetchResources(\n  customConnectResource('test'),\n  {\n    refresh: false,\n  }\n)\n\n")),Object(o.b)("h2",{id:"several-resources"},"Several resources"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import { customResource, prefetchResources } from '@cranium/resource'\n\nfunction myCustomFetch(API, payload, meta) {\n  return API.get('/context')\n}\n\nconst customConnectResource = customResource(myCustomFetch)\n\nexport default prefetchResources([\n    'users',\n    'cars',\n    {\n      namespace: 'context', \n      endpoint: `context/data`\n    },\n    customConnectResource('dogs')\n  ],\n  {\n    Loader: Loader,\n  }\n)\n")),Object(o.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(r.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(r.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(o.b)("path",Object(r.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Please do not use React life-cycle methods to send HTTP request on mount by your own.\nIt is important to use ",Object(o.b)("strong",{parentName:"p"},"prefetchResources")," for several reasons:"),Object(o.b)("ul",{parentName:"div"},Object(o.b)("li",{parentName:"ul"},"do not duplicate code"),Object(o.b)("li",{parentName:"ul"},"do not loose implementation that is already done in ",Object(o.b)("strong",{parentName:"li"},"prefetchResources"))))))}b.isMDXComponent=!0},169:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),b=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s({},t,{},e)),n},u=function(e){var t=b(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},m=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),u=b(n),m=r,d=u["".concat(c,".").concat(m)]||u[m]||p[m]||o;return n?a.a.createElement(d,s({ref:t},l,{components:n})):a.a.createElement(d,s({ref:t},l))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,c=new Array(o);c[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:r,c[1]=s;for(var l=2;l<o;l++)c[l]=n[l];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);