(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{135:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return u}));var a=n(1),r=n(6),o=(n(0),n(169)),i={id:"resource_withFinalForm",title:"withFinalForm",sidebar_label:"withFinalForm"},c={id:"resources/resource_withFinalForm",title:"withFinalForm",description:"Function that returns HOC to connect your React Component with [connectResources](/docs/resources/connect_resources) and [react-final-form](https://final-form.org/react).",source:"@site/docs/resources/withFinalForm.md",permalink:"/bones/docs/resources/resource_withFinalForm",editUrl:"https://github.com/alexgul4enko/bones/tree/master/docs/docs/resources/withFinalForm.md",sidebar_label:"withFinalForm",sidebar:"resourcesSitebar",previous:{title:"prefetchResources",permalink:"/bones/docs/resources/resource_prefetchResources"},next:{title:"withInfinityList",permalink:"/bones/docs/resources/resource_withInfinityList"}},s=[{value:"formConfigs",id:"formconfigs",children:[{value:"validate",id:"validate",children:[]},{value:"onSubmit",id:"onsubmit",children:[]},{value:"onSubmitSuccess",id:"onsubmitsuccess",children:[]},{value:"onSubmitFailed",id:"onsubmitfailed",children:[]},{value:"valuesInterceptor",id:"valuesinterceptor",children:[]},{value:"initialValues",id:"initialvalues",children:[]}]},{value:"resources",id:"resources",children:[{value:"Resource config",id:"resource-config",children:[]}]},{value:"options",id:"options",children:[{value:"prefetch",id:"prefetch",children:[]}]},{value:"REST API FLOW",id:"rest-api-flow",children:[{value:"Update existing",id:"update-existing",children:[]},{value:"Create new",id:"create-new",children:[]},{value:"Navigation params with Forms",id:"navigation-params-with-forms",children:[]}]},{value:"customResource",id:"customresource",children:[]}],l={rightToc:s};function u(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Function that returns HOC to connect your React Component with ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/resources/connect_resources"}),"connectResources")," and ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://final-form.org/react"}),"react-final-form"),"."),Object(o.b)("p",null,"This HOC will pass to your React Component ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://final-form.org/docs/react-final-form/types/FormRenderProps"}),"form props")," from  react-final-form and props from",Object(o.b)("inlineCode",{parentName:"p"},"connectResources")),Object(o.b)("p",null,"Also this HOC will predefine ",Object(o.b)("inlineCode",{parentName:"p"},"onSubmit")," function. In case your are using ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/resources/resource_customresources"}),"customresource"),", then it will use ",Object(o.b)("inlineCode",{parentName:"p"},"this.props[namespace].request"),". Otherwise it will send ",Object(o.b)("inlineCode",{parentName:"p"},"POST")," or ",Object(o.b)("inlineCode",{parentName:"p"},"PATCH")," HTTP request based on endpoint and props."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-javascript"}),"import { withFinalForm } from '@cranium/resource'\n\nwithFinalForm(formConfigs, resources, options)\n")),Object(o.b)("h2",{id:"formconfigs"},"formConfigs"),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Property"),Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"type"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"validate"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"function(values, props):Object\\|Promise"))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"onSubmit"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"function(values, form, props):Promise"))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"onSubmitSuccess"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"function(apiResults, props):void"))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"onSubmitFailed"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"function(apiError, props):void"))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"valuesInterceptor"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"function(values, props, form):Object"))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"initialValues"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"Object\\|function(props):Object"))))),Object(o.b)("h3",{id:"validate"},"validate"),Object(o.b)("p",null,"Function to handle form level validation."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { withFinalForm } from '@cranium/resource'\n\nfunction validate (values, props) {\n  const errors = {}\n  if(!values.password){\n    errors.password = 'This field is required'\n  }\n  if(values.city === 'NY' && props.country === 'UK'){\n    errors.city = 'There is no such city in UK'\n  }\n  return errors\n}\n\nexport default withFinalForm(\n  {\n    validate: validate\n  },\n  'users'\n)\n")),Object(o.b)("h3",{id:"onsubmit"},"onSubmit"),Object(o.b)("p",null,"Custom Submit function. You can use it to override default logic."),Object(o.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"By default ",Object(o.b)("inlineCode",{parentName:"p"},"onSubmit")," will send POST or PATCH request based on props. And use ",Object(o.b)("inlineCode",{parentName:"p"},"request")," in case you. are using ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/resources/resource_customresources"}),"customresource")))),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Please note that it is important to return ",Object(o.b)("inlineCode",{parentName:"p"},"Promise")," from ",Object(o.b)("inlineCode",{parentName:"p"},"onSubmit")," function."),Object(o.b)("pre",{parentName:"div"},Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"function(values, form, props):Promise\n")))),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm(\n  {\n    onSubmit: (values, form, props)=>{\n      return props.users.create(values)\n    }\n  },\n  'users'\n)\n")),Object(o.b)("h3",{id:"onsubmitsuccess"},"onSubmitSuccess"),Object(o.b)("p",null,"Callback function for success submitting. It is the best place for navigation and alerts"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"function(apiResults, props):void\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm(\n  {\n    onSubmitSuccess: (values, props)=>{\n      props.history.push('some_route')\n    }\n  },\n  'users'\n)\n")),Object(o.b)("h3",{id:"onsubmitfailed"},"onSubmitFailed"),Object(o.b)("p",null,"Callback function to handle non field errors. Here is the best place to show alerts"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"function(apiError, props):void\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm(\n  {\n    onSubmitFailed: (apiError, props)=>{\n      props.alert(apiError.error)\n    }\n  },\n  'users'\n)\n")),Object(o.b)("h3",{id:"valuesinterceptor"},"valuesInterceptor"),Object(o.b)("p",null,"Interceptor function that can help you to modify react-final-form values before sending submit action."),Object(o.b)("p",null,"Here you also has props from your Component so that to can merge form values and props if needed."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ts"}),"function(values, props, form):Object\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm(\n  {\n    valuesInterceptor: (values, props, form)=>{\n      return {\n        ...values,\n        city: props.city,\n        name: values.name.toUpperCase()\n      }\n    }\n  },\n  'users'\n)\n")),Object(o.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Please pay attention that you can not call any function that will change store or form state in ",Object(o.b)("inlineCode",{parentName:"p"},"valuesInterceptor")," function. This should be pure function without any side effects!"))),Object(o.b)("h3",{id:"initialvalues"},"initialValues"),Object(o.b)("p",null,"Configuration to setup form initial values."),Object(o.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"By default ",Object(o.b)("inlineCode",{parentName:"p"},"initialValues")," are resource data."),Object(o.b)("pre",{parentName:"div"},Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm({}, 'users/me')(FormViewComponent)\n//In this case `withFinalForm` will send GET /api/users/me request and setup initial values as a response from API call.\n")))),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"// initial values as const\nimport { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm({\n  initialValues: {\n    account: 'Conductor'\n  }\n}, 'users/me')(FormViewComponent)\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"// initial values as a function\nimport { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm({\n  initialValues: (props)=> {\n    return {\n      account: props.account\n    }\n  }    \n}, 'users/me')(FormViewComponent)\n")),Object(o.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Please pay attention that you can not call any function that will change store or react state in ",Object(o.b)("inlineCode",{parentName:"p"},"initialValues")," function. This should be pure function without any side effects!"))),Object(o.b)("h2",{id:"resources"},"resources"),Object(o.b)("p",null,Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/resources/connect_resource_type"}),"Resource config")," or ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/resources/resource_customresources"}),"Custom Resource")),Object(o.b)("h3",{id:"resource-config"},"Resource config"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"//POST /api/users onSubmit\nimport { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm({}, 'users')(FormViewComponent)\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"//POST /api/users/me onSubmit\nimport { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm({}, { namespace: 'profile', endpoint: 'users/me' })(FormViewComponent)\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"// custom resource\nimport { customResource, withFinalForm } from '@cranium/resource'\n\nfunction customResource(API, payload, meta, store ) {\n  API.patch('users/:uuid', payload, { params: { uuid: payload: uuid } } )\n    .then(()=> API.get('users/:uuid', { params: { uuid: payload: uuid } }))\n} \n\nconst connectResource = customResource(customResource)\n\nexport default withFinalForm({}, connectResource('profile'))(FormViewComponent)\n\n")),Object(o.b)("h2",{id:"options"},"options"),Object(o.b)("p",null,"Object with additional configurations. To read more visit this ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/resources/resource_prefetchResources#options"}),"link")," "),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Property"),Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"type"),Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Default"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"/docs/resources/resource_prefetchResources#refresh"}),"refresh")),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Boolean"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"true")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"/docs/resources/resource_prefetchResources#destroyonunmount"}),"destroyOnUnmount")),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Boolean"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"true")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"/docs/resources/resource_prefetchResources#defaultparams"}),"defaultParams")),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Object"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"null")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("a",Object(a.a)({parentName:"td"},{href:"/docs/resources/resource_prefetchResources#loader"}),"Loader")),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"React Element"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}))),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"method"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"'GET'"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"POST")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"prefetch"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Boolean"),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"true")))),Object(o.b)("p",null,"Most configurations are same with ",Object(o.b)("inlineCode",{parentName:"p"},"prefetchResources"),". But here is one new param ",Object(o.b)("inlineCode",{parentName:"p"},"prefetch")),Object(o.b)("h3",{id:"prefetch"},"prefetch"),Object(o.b)("p",null,"Boolean flag to configure if ",Object(o.b)("inlineCode",{parentName:"p"},"withFinalForm")," HOC needs to send initial API request to setup initial values."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"//POST /api/users/me on mount and setup initial values\nimport { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm({}, 'users/me', {\n  prefetch: true\n})(FormViewComponent)\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"//DO not send any GET requests on mount initial values are empty or defined with `initialValues` option\nimport { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm({}, 'users/me', {\n  prefetch: false\n})(FormViewComponent)\n")),Object(o.b)("h2",{id:"rest-api-flow"},"REST API FLOW"),Object(o.b)("p",null,"By default ",Object(o.b)("inlineCode",{parentName:"p"},"resources")," were build to work REST API. This means that in general for all forms you will have 2 possible scenarios:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Create user => POST /users"),Object(o.b)("li",{parentName:"ul"},"Update existing user => PATCH /users/:uuid")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { withFinalForm } from '@cranium/resource'\n\nwithFinalForm({\n    validate,\n    onSubmitSuccess,\n  },{\n    namespace: 'users',\n    endpoint: 'users/:uuid?'\n  }, {\n    prefetch: true //this is default value. and it is here just for example\n  })(MyReactElement)\n")),Object(o.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"The most important thing here is to define endpoint with dynamic param ",Object(o.b)("inlineCode",{parentName:"p"},"users/:uuid?")," and this param should be optional ",Object(o.b)("inlineCode",{parentName:"p"},"?")," at the end of arg name.  "))),Object(o.b)("p",null,"Having this configurations you will get the most suitable implementation for REST API.\nHere we will have 2 scenarios:"),Object(o.b)("h3",{id:"update-existing"},"Update existing"),Object(o.b)("p",null,"Component has ",Object(o.b)("inlineCode",{parentName:"p"},"props.uuid")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js",metastring:'title="myform.js"',title:'"myform.js"'}),"import { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm({\n    validate,\n    onSubmitSuccess,\n  },{\n    namespace: 'users',\n    endpoint: 'users/:uuid?'\n  }, {\n    prefetch: true //this is default value. and it is here just for example\n  })(MyReactElement)\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import MyForm from 'myform'\n\nfunction App () {\n  return <MyForm uuid=\"234\"/>\n}\n")),Object(o.b)("p",null,"That means that it is form for updating existing user.\nIn this case u will have:\n1. Send GET /users/:uuid on mount\n2. Pass response data as initial values\n3. Send PATCH /users/:uuid on submit"),Object(o.b)("h3",{id:"create-new"},"Create new"),Object(o.b)("p",null,"Component does not has ",Object(o.b)("inlineCode",{parentName:"p"},"props.uuid")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js",metastring:'title="myform.js"',title:'"myform.js"'}),"import { withFinalForm } from '@cranium/resource'\n\nexport default withFinalForm({\n    validate,\n    onSubmitSuccess,\n  },{\n    namespace: 'users',\n    endpoint: 'users/:uuid?'\n  }, {\n    prefetch: true //this is default value. and it is here just for example\n  })(MyReactElement)\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import MyForm from 'myform'\n\nfunction App () {\n  return <MyForm />\n}\n")),Object(o.b)("p",null,"That means that it is form to create new user."),Object(o.b)("p",null,"In this case it will have different scenario:\n1. ",Object(o.b)("inlineCode",{parentName:"p"},"prefetch: true")," option will skip. There will not be GET request on mount\n2. initial values will be empty.\n3. Send POST /users on submit"),Object(o.b)("h3",{id:"navigation-params-with-forms"},"Navigation params with Forms"),Object(o.b)("p",null,"You can use same Component for both Edit and Create forms. That are rendered on 2 different screens."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js",metastring:'title="form.js"',title:'"form.js"'}),"import { withFinalForm } from '@cranium/resource'\nimport { compose } from 'redux'\n\nexport default compose(\n  withFinalForm({\n    validate,\n    onSubmitSuccess,\n  },{\n    namespace: 'users',\n    endpoint: 'users/:uuid?'\n  }, {\n    prefetch: true //this is default value. and it is here just for example\n  })\n)(MyReactElement)\n")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js",metastring:'{5,6,9,10} title="routes.js"',"{5,6,9,10}":!0,title:'"routes.js"'}),"import Form from 'form'\n\nexport const routes = [\n  {\n    path: 'users/:uuid/edit',\n    component: Form\n  },\n  {\n    path: 'users/create',\n    component: Form\n  },\n]\n")),Object(o.b)("h2",{id:"customresource"},"customResource"),Object(o.b)("p",null,"You can use customResource in pair with withFinalForm."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"import { customResource, withFinalForm } from '@cranium/resource'\n\nfunction myCustomFetch(API, payload, meta) {\n  if(meta.type === 'PREFETCH') { //initial GET request to setup form initial values\n    return API.get('users/me')\n  }\n  if(meta.method === 'POST') { // create new user\n    return API.post('users' payload)\n  }\n  if(meta.method === 'PUT') { // update user\n    return API.put('users/:uuid' payload, { params: { uuid: users.uuid }})\n  }\n}\n\nconst customConnectResource = customResource(myCustomFetch)\n\nexport default withFinalForm(\n  {\n    validate,\n  },\n  customConnectResource({\n    namespace: 'users',\n    endpoint: 'users/:uuid?'\n  }),\n  {\n    Loader: MyCustomLoader,\n  }\n)(ReactFormComponent)\n\n//same with short syntax\nexport default withFinalForm(\n  {\n    validate,\n  },\n  customConnectResource('users/:uuid?'),\n  {\n    Loader: MyCustomLoader,\n  }\n)(ReactFormComponent)\n")),Object(o.b)("p",null,"Using this configuration it will call ",Object(o.b)("inlineCode",{parentName:"p"},"myCustomFetch")," function on mount component and on Submit.\nPlease, pay attention that prefetch option and REST API flow has same flow as with using simple resource the only one difference is that you can define your own async action."))}u.isMDXComponent=!0},169:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return d}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),u=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c({},t,{},e)),n},b=function(e){var t=u(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},p=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),b=u(n),p=a,d=b["".concat(i,".").concat(p)]||b[p]||m[p]||o;return n?r.a.createElement(d,c({ref:t},l,{components:n})):r.a.createElement(d,c({ref:t},l))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=p;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var l=2;l<o;l++)i[l]=n[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);